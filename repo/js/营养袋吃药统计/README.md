# 药品消耗统计脚本使用指南

## 📋 一、脚本概述

本脚本是一款专为《原神》设计的自动化工具，主要功能如下：

- **自动识别**：通过OCR技术读取背包中指定药品的数量
- **智能统计**：记录每日药品消耗/新增变化，统计周期为当日4点至次日4点
- **数据管理**：自动保存30天历史记录，过期数据自动清理
- **智能提醒**：通过系统通知推送药品变化信息

## 🛠️ 二、环境与工具要求

### 必备工具：茶包版BGI

**为什么不推荐公版BGI？**

公版BGI执行JS脚本时默认关闭自动吃药功能，且无法通过脚本代码开启。本脚本的设计逻辑完全依赖自动吃药功能的正常运行：

- 药品消耗主要发生在自动吃药场景中
- 脚本未内置开启自动吃药的适配代码

### 系统配置要求

1. **游戏分辨率**：1920×1080（固定不可改）
2. **游戏内设置**：
   - 装备「便携营养袋」
   - 确保游戏界面无遮挡、无缩放
3. **模板文件**：确认`assets/RecognitionObject/`文件夹包含所有必要的模板图片

## 📥 三、获取茶包版BGI

1. **直接获取**：在脚本仓库搜索关键词「茶包」，进入作者主页下载
2. **备用方案**：查阅「锄地一条龙js」的README文档，通过文档末尾的群号加入测测莫酱交流群获取

## ⚙️ 四、使用前配置

### 1. 基础检查

- [ ] 游戏分辨率为1920×1080
- [ ] 已装备「便携营养袋」
- [ ] 茶包版BGI中已开启「自动吃药」功能

### 2. 参数设置（关键步骤）

| 参数项 | 填写要求 | 示例         |
|--------|----------|------------|
| **userName** | 1-20字符，仅支持中英文、数字 | "旅行者001"   |
| **recoveryFoodName** | 与游戏内名称完全一致 | "美味的甜甜花酿鸡" |
| **resurrectionFoodName** | 与游戏内名称完全一致 | "美味的提瓦特煎蛋" |
| **initSelect** | 默认关闭，仅初始化时临时开启 | 取消勾选       |

**重要**：药品名称必须完全匹配。

## 🔄 五、操作流程

### 场景一：首次使用 / 新账户

1. 完成上述配置后运行脚本
2. 脚本自动执行：
   - 校验账户名合法性
   - 打开背包识别药品数量
   - 创建记录文件（路径：`assets/账户名.txt`）
3. 收到「今日初始化完成」通知

### 场景二：日常使用

- **每日首次运行**（4点后）：记录为当日初始值
- **后续运行**：对比最新数量，计算消耗/新增
- **自动记录**：每次运行都会保存一次记录数据
- **智能清理**：仅保留30天内数据

### 场景三：更换药品或重置数据

1. 在设置中**勾选`initSelect`选项**
2. 运行脚本一次
3. **务必取消勾选`initSelect`**

**效果**：删除当日同名药品记录，以当前数量重新初始化。

## 📊 六、核心机制说明

### 统计周期规则

- 以**凌晨4点**为分界点
- 举例：当前时间3点，统计昨天4点至今的数据
- 当前时间5点，统计今天4点起的数据

### 记录格式示例

```
时间:2023/10/15 14:30:45-美味的甜甜花酿鸡-18
时间:2023/10/15 14:30:45-美味的提瓦特煎蛋-6
```

### 异常处理机制

| 异常情况 | 自动处理方式 |
|----------|-------------|
| 药品未识别 | 数量设为0，发送通知提醒 |
| 记录文件格式错误 | 自动重置文件 |

## ⚠️ 七、重要注意事项

### 每日首次使用时机建议

- **在锄地一条龙前**
- **在药品制作后**
- **避免**在两次脚本运行之间制作大量药品

### 常见误区

1. **`initSelect`常开**：导致每次运行都重新初始化
2. **名称不准确**：最常导致识别失败的原因
3. **窗口遮挡**：影响OCR识别准确率
4. **多账户混淆**：每个账户有独立记录文件

## 🔧 八、故障排查指南

### 快速自查表

| 问题现象 | 优先检查项 |
|----------|------------|
| 药品数量识别为0 | 1. 药品名称准确性<br>2. 背包中是否有该药品<br>3. 分辨率是否为1920×1080 |
| 统计数据异常 | 1. 是否在脚本运行期间操作药品<br>2. 是否每日4点后首次运行<br>3. `initSelect`是否误开启 |
| 自动吃药无效 | 1. 是否使用茶包版BGI<br>2. BGI中自动吃药功能是否开启 |

