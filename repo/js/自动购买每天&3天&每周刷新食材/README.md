# 自动购买每天&3天&每周刷新食材 - 使用说明

## 功能说明

这个脚本可以自动购买原神游戏中各个商人的食材，支持三种刷新周期：
- **每天刷新食材**：每天凌晨4点刷新
- **3天刷新食材**：每3天刷新一次
- **每周刷新食材**：每周刷新，可指定购买日
- **智能记录系统**：避免重复购买，只购买刷新后的商品

## 快速开始

### 1. 准备工作
- 游戏分辨率：**1920×1080 解析度**
- 游戏内时间需可调整（非多人模式）
- 准备足够的摩拉购买食材

### 2. 首次使用
1. 打开脚本设置界面
2. 勾选要购买的食材
3. 设置每周食材购买日
4. 保存设置
5. 在主界面运行脚本

## 设置说明
- **账号名**：区分不同账号的记录
- **无视记录强制购买**：不推荐开启，会重复购买
- **记录调试模式**：显示详细日志信息
- **禁用NPC功能**：可以输入要禁用的NPC名称（空格分隔）：
  ```
  布兰琪 东升 莎拉
  ```

  禁用后，脚本会跳过这些NPC，不会前往购买。

### 食材设置
食材分为三类，可以单独选择是否购买：
1. **每天刷新食材** - 每天凌晨4点刷新
2. **3天刷新食材** - 每3天刷新一次
3. **每周刷新食材** - 每周固定週一购买

### 购买日设置
- **0**：跟随游戏系统周期自动判断
- **1-7**：指定週几购买（1=週一，7=週日）

## 调试模式

开启`记录调试模式`后，会显示详细执行信息：

```
[调试] 开始处理NPC: 布兰琪
[调试] NPC当前记录: {npcname: "布兰琪", 1d_time: "2024-12-10T04:00:00+08:00"}
[调试] 购买判断结果:
[调试]   1天商品: 盐, 胡椒, 洋葱
[调试]   开始购买第 1 页
[调试] 尝试购买: 盐
[调试] 找到物品: 盐 位置(100,200,90,90)
购买成功: 盐
交互或拾取："盐"
```

```json
## 数据文件说明

脚本使用外部数据文件，方便维护：

### 食材数据 (assets/data/foods.json)
```json
{
  "盐": {
    "id": "盐",
    "name": "盐",
    "file": "assets/images/salt.png"
  }
}
```

### NPC数据 (assets/data/npcs.json)
```json
{
  "布兰琪": {
    "name": "布兰琪",
    "enable": true,
    "page": 2,
    "time": "night",
    "path": "assets/path/蒙德-蒙德城-布兰琪.json",
    "_1d_foods": ["盐", "胡椒", "洋葱"]
  }
}
```

### 图片要求
- 尺寸：90×90像素
- 格式：PNG
- 路径：assets/images/

### 路径文件
- 格式：JSON
- 路径：assets/path/

## 添加新食材

### 1. 添加食材图片
将食材截图保存为`assets/images/新食材.png`
- 食材图片：85×85像素PNG格式

### 2. 添加食材设置
在`settings.json`中添加：
```json
{
    "name": "新食材",
    "type": "checkbox",
    "label": "新食材",
    "default": false
}
```

### 3. 添加食材数据
在`assets/data/foods.json`中添加：
```json
"新食材": {
  "id": "新食材",
  "name": "新食材",
  "file": "assets/images/新食材.png"
}
```

### 4. 添加NPC数据
在`assets/data/npcs.json`中为对应的NPC添加：
```json
"_1d_foods": ["新食材"]  // 根据刷新周期选择
```

## 如何添加新的NPC商人
### 准备工作
1. 路径文件：錄製前往NPC的路径JSON文件
2. 命名规则：`国家-地区-NPC名称.json`
### 添加步骤

#### 1. 添加食材数据（如未添加）
在 `assets/data/foods.json` 中添加：
```json
"新食材": {
    "id": "新食材",
    "name": "新食材",
    "file": "assets/images/新食材.png"
}
```

在 `settings.json` 对应区域添加食材选项。

#### 2. 添加NPC数据
在 `assets/data/npcs.json` 中添加：
```json
"新NPC名称": {
    "name": "新NPC名称",
    "enable": true,
    "page": 2,
    "time": "any",
    "path": "assets/path/国家-地区-新NPC名称.json",
    "_1d_foods": ["食材1", "食材2"],
    "_3d_foods": ["食材3"],
    "_7d_foods": ["食材4"]
}
```

**参数说明**：
- `page`：商店总页数
- `time`：`any`(任何时间)/`day`(白天)/`night`(晚上)
- `_1d_foods`：每天刷新食材列表
- `_3d_foods`：3天刷新食材列表  
- `_7d_foods`：每周刷新食材列表

#### 3. 放置相关文件
- 食材图片：`assets/images/新食材.png`
- 路径文件：`assets/path/国家-地区-NPC名称.json`

#### 4. 测试验证
1. 重新加载脚本设置
2. 勾选新食材
3. 运行脚本测试购买流程
4. 检查日志确认执行成功

### 注意事项
- NPC名称需与路径文件名称对应
- 食材名称需与foods.json中的name一致
- 首次添加建议开启调试模式检查


## 常见问题

### 1. 脚本不购买食材
- 检查游戏是否在主界面
- 确认解析度设定正确（1920×1080）
- 检查NPC是否在正确时间出现（白天/晚上）
- 查看是否有足够的摩拉

### 2. 记录不更新
- 检查`record/账号名/records.json`文件权限
- 开启调试模式查看详细日志

### 3. 图片识别失败
- 确认图片尺寸为90×90
- 检查图片路径是否正确
- 尝试重新截图

### 4. 路径执行失败
- 确认路径文件存在
- 检查NPC是否被障碍物阻挡
- 尝试重新录制路径

## 记录系统

脚本会自动记录购买时间，保存在`record/账号名/records.json`：

```json
[
  {
    "npcname": "布兰琪",
    "1d": ["盐", "胡椒", "洋葱"],
    "1d_time": "2024-12-10T04:00:00+08:00",
    "3d": [],
    "3d_time": null,
    "7d": [],
    "7d_time": null
  }
]
```

## 注意事项

1. 脚本运行时不要操作游戏
2. 确保背包有足够空间
3. 每个NPC购买完成后会返回主界面
4. 脚本会自动调整游戏时间（白天/晚上）
5. 每周食材购买日设置后，只在指定日期购买4. 逐一添加食材测试

## 🤝 贡献指南

欢迎提交新的食材配置！请遵循以下格式：

1. **提交新的NPC**：包含路径文件和图片
2. **提交新的食材**：包含图片和设定
3. **问题回报**：提供详细的重现步骤和日志

---

> 注意：本脚本仅供学习与研究使用，请遵守游戏使用条款。