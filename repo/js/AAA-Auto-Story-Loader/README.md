# 自动剧情加载器 - 使用说明

## 项目宗旨

自动剧情加载器是专为委托开发者设计的**脚本调试与编辑工具**，旨在提升委托开发效率，简化测试流程。

> **重要声明**：
> 1. 本项目**不会将任何非委托任务流程脚本上传至脚本仓库**
> 2. **禁止任何人用于商业用途**，禁止在任何场合展示或宣传自动任务效果
> 3. **不提倡**上传任何任务流程脚本到公开平台
> 4. 工具仅提供技术框架，**不包含任何自动游戏剧情内容**
> 5. 请勿在任何官方平台（米游社、B站、微博等）讨论本工具
> 6. 严禁在官方直播、动态或社区提及本工具相关内容

**免责声明：**

1. **使用风险：**
   1. 本脚本为开源学习项目，仅为游戏委托开发提供技术支持，禁止用于商业用途或违反游戏条款的行为。

2. **责任限制：**
   1. 本脚本按“现状”提供，不承诺兼容性、安全性或功能完整性。
   2. 用户应自行承担使用风险，并严格遵守《原神》用户协议。因使用本脚本导致的损失，开发者概不负责。

使用即表示您已阅读并同意上述条款。

---

## 使用方法及配置
1. 将脚本添加至调度器。
2. 右键点击脚本以修改 JS 自定义配置。
3. 在设置中选择"刷新剧情列表"
4. 工具将扫描所有可用剧情脚本
5. 从更新后的列表中选择要执行的剧情

## 安全规范

### 社区公约
> "我们理解大家对工具的热情，但脚本属于敏感领域。请务必：
> - 不在任何官方平台讨论技术细节
> - 不在直播、视频中展示工具效果
> - 不与官方产生任何形式冲突
> 
> 保持低调才能让工具持续可用！"

### 开发者社区
```markdown
如急需自动剧情脚本，请加入开发者社群：
▨ QQ群：[开发者群号]（加作者QQ获取）
▨ 作者QQ：3302871403
▨ 小提示：群内还有提瓦特全战斗宝箱
                 5.8部分解谜宝箱
                 部分已下架的资源
```

> **再次强调**：
> - **禁止任何人用于商业用途**，禁止在任何场合展示或宣传自动任务效果
> - **不要将任何非委托任务流程脚本上传至脚本仓库**

**让我们共同维护良好的社区环境！让大家都BetterGI用！**

---

## 以下为开发指南

---

## 1 制作前检查
- 打开 [AutoCommission 开发进度表格](https://docs.qq.com/sheet/DWGRCTGtDUGVPa1h0?tab=BB08J2)  

---

## 2 了解委托信息
- 名称：在任务界面看到的完整委托标题  
- 地点：地图右上角名称

---

## 3 创建流程文件
路径规则  \process\{委托名称}\{委托地点}\process.json
- 使用 UTF-8 无 BOM 编码保存。  
- 所有子流程（如 `取餐.json`）放在同一目录，方便相对路径引用。

---

## 4 流程文件格式总览

### 4.1 基本结构
```json
[
  {
    "type": "<步骤类型>",
    "data": <任意类型>,
    "note": "控制台日志，可选",
    "run": "<子流程文件名，可选，仅分支步骤>"
  }
]
```

### 4.2 支持的步骤类型
| type | 作用 | data 示例 | 备注 |
|---|---|---|---|
| 委托描述检测 | 按 J 打开任务界面并匹配委托详情 | `"取得制作好的餐品"` | 支持 `run` 跳转子流程 |
| 地址检测 | 检测玩家坐标与给定坐标差距 ≤15 | `[-667, 2285]` | 支持 `run` 跳转子流程 |
| 地图追踪 | 执行地图寻路脚本 | `"tracking1.json"` | 相对路径 |
| 键鼠脚本 | 执行键鼠脚本 | `"script1.json"` | 相对路径 |
| 对话 | 自动对话并优先选择指定选项 | 见下方详解 | |
| 按键 | 按一次键盘按键 | `"F"` 或 `{"action":"press","key":"E"}` | 复杂按键操作对象，包含 action （动作，如"down"、"up"、"press"）和 key （按键值）|
| tp | 强制传送到坐标 | `[100,200,true]` | 已不常用 |
| 等待 | 自定义等待 | `3000`（毫秒） | 默认 5000 ms |
| 自动任务 | 开启/关闭 AutoSkip、AutoPick | 见下方详解 | |
| 等待返回主界面 | 判断返回主界面 | — | 无 data |
| 追踪委托 | 追踪NPC头顶图标 | data可以直接写npc的名字（字符串类型），也可以写成一个列表，name是npc的名字，iconType追踪的标,Bigmap大地图的委托图标，Question问号图标，Task任务图标（默认） | 好用 |
---

## 5 对话步骤详解
```json
{
  "type": "对话",
  "data": {
    "skipCount": 5,
    "priorityOptions": ["同意", "接受委托", "我来帮忙"],
    "npcWhiteList": ["派蒙", "凯亚", "安柏"]
  },
  "note": "优先选“同意”等选项，且只与白名单 NPC 交互"
}
"skipCount"跳过的前置无选项的对话次数，"priorityOptions"对话中可选的内容，npcWhiteList可以对话的npc
```

---

## 6 自动任务步骤详解
#### 功能特点
- 动态启用/禁用自动任务
- 支持任务配置参数
- 统一的任务管理接口

#### 使用方法

**1. 启用自动拾取（默认配置）**
```json
{
  "type": "自动任务",
  "data": {
    "action": "enable",
    "taskType": "AutoPick"
  },
  "note": "启用自动拾取"
}
```

**2. 启用自动拾取（自定义配置）**
```json
{
  "type": "自动任务",
  "data": {
    "action": "enable",
    "taskType": "AutoPick",
    "config": {
      "forceInteraction": false
    }
  },
  "note": "启用自动拾取，禁用急速拾取模式"
}
```

**3. 启用自动剧情**
```json
{
  "type": "自动任务",
  "data": {
    "action": "enable",
    "taskType": "AutoSkip"
  },
  "note": "开启自动剧情"
}
```

**4. 取消所有自动任务**
```json
{
  "type": "自动任务",
  "data": {
    "action": "disable"
  },
  "note": "取消所有自动任务"
}
```

#### 参数详细说明

**action** (必需)
- 类型: string
- 可选值: "enable" | "disable"
- "enable": 启用自动任务
- "disable": 取消所有自动任务

**taskType** (启用时必需)
- 类型: string
- 可选值: "AutoSkip" | "AutoPick"
- "AutoSkip": 自动剧情
- "AutoPick": 自动拾取

**config** (可选)
- 类型: object
- 用于配置任务的具体参数
- 对于 AutoPick 任务:
  - `forceInteraction`: boolean - 是否启用急速拾取模式

#### 支持的任务类型

| 任务类型 | 说明 | 支持的配置 |
|---------|------|----------|
| AutoSkip | 自动剧情 | 无特殊配置 |
| AutoPick | 自动拾取 | forceInteraction: 急速拾取模式开关 |

---

## 7 分支（条件跳转）机制
仅 `委托描述检测` 与 `地址检测` 支持 `run` 字段：  
- 条件匹配 → 执行 `run` 指向的子流程,子流程使用process.json同样的写法
- 条件不匹配 → 跳过本步骤继续往下执行

示例：  
```json
[
  {
    "type": "委托描述检测",
    "data": "取得制作好的餐品",
    "note": "分支名字正确的情况",
    "run": "取餐.json"
  },
  {
    "type": "地址检测",
    "data": [-667, 2285],
    "note": "距离目标 ≤15",
    "run": "让纳西妲进尘歌壶.json"
  }
]
```

---

## 8 完整示例
下面是一份可直接使用的 `process.json` 模板，含新功能：
```json
[
  {
    "type": "自动任务",
    "data": { "action": "enable", "taskType": "AutoPick", "config": { "forceInteraction": false } },
    "note": "启用自动拾取（非急速）"
  },
  {
    "type": "地图追踪",
    "data": "tracking1.json",
    "note": "前往目标 NPC"
  },
  {
    "type": "等待",
    "data": 2000,
    "note": "等待传送动画"
  },
  {
    "type": "对话",
    "data": {
      "skipCount": 3,
      "priorityOptions": ["确定", "好的"],
      "npcWhiteList": ["鲁道夫"]
    },
    "note": "与鲁道夫对话"
  },
  {
    "type": "自动任务",
    "data": { "action": "disable" },
    "note": "清理自动任务"
  }
]
```

> 完成后把 `process.json` 及所有子流程文件打包发给审核即可。祝制作顺利！