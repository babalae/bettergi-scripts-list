# 自动锻造魔矿脚本

## ⚠️ 免责声明

> **重要提示：请在使用前仔细阅读以下内容**

### 使用风险
本脚本为开源学习项目，仅限个人学习使用，**禁止用于商业用途或任何违反游戏条款的行为**。滥用可能导致游戏账号封禁，开发者不承担任何直接或间接责任。

### 责任限制
本脚本按"现状"提供，不承诺兼容性、安全性或功能完整性。因使用本脚本导致的账号、数据、设备等任何损失，开发者概不负责。

### 禁止条款
严禁对本脚本进行逆向工程、恶意篡改或用于外挂等非法用途。如游戏运营商提出要求，开发者保留随时停止维护的权利。

**使用本脚本即表示您已阅读、理解并同意上述所有条款。**

## 📞 联系与反馈

如有任何建议或问题，欢迎通过以下方式联系：  
📧 QQ：1765137214

---

## ✨ 功能介绍
适用于原神 5.6 
BGI 0.48.2 版本
本脚本能够自动前往指定铁匠铺，通过智能图像识别技术自动选择或按预设优先级锻造魔矿：

- 🗺️ **自动寻路** - 智能导航至指定铁匠铺
- 🔍 **矿石识别** - 支持多种矿石的自动识别与选择
- 🎯 **双模式锻造** - 提供自动和手动两种智能模式
- 📊 **状态通知** - 实时桌面通知与详细执行日志
- 🛡️ **异常处理** - 智能应对各种异常情况

## 📁 文件结构

```
自动锻造魔矿脚本/
├── main.js              # 核心业务逻辑
├── manifest.json        # 脚本元信息与基础配置
└── settings.json        # 用户自定义配置文件
```

## 🚀 快速开始

### 1. 安装脚本
将本脚本添加至 BGI 脚本调度器。

### 2. 配置参数
右键点击脚本，选择"编辑 JS 配置"或直接修改 `settings.json` 文件：

```json
{
  "smithyName": "枫丹铁匠铺",
  "ore": "水晶块",
  "secondaryOre": "紫晶块",
  "tertiaryOre": "萃凝晶",
  "notice": true,
  "forgedOrNot": "是",
  "model": "模式一"
}
```

### 3. 矿石配置说明

**默认支持矿石**：
- 水晶块
- 紫晶块
- 萃凝晶

**扩展矿石配置**：  
如需使用"星银矿石"、"白铁块"或"铁块"，请在 `settings.json` 中取消对应矿石前的注释(`//`)，保存后即可生效。

## ⚙️ 功能详解

### 🔧 锻造模式

| 模式 | 描述 |
|------|------|
| **模式一（自动）** | 自动识别背包中数量最多的矿石进行锻造，识别失败时自动切换到手动优先级模式（可能存在数量识别错误） |
| **模式二（手动）** | 按照用户配置的优先级顺序，依次尝试主选及备选矿石 |

### 🎯 特殊功能

- **仅领取锻造**：如选择"否"，则仅检测并领取已完成的锻造奖励
- **智能兜底**：自动模式识别失败时，自动切换到手动优先级模式
- **通知与日志**：支持桌面通知和详细日志，便于追踪脚本执行状态
- **异常处理**：多次识别失败、材料不足等情况均有详细提示和自动处理

## 📋 使用注意事项

1. **环境要求**：确保游戏分辨率、BGI 版本与脚本要求一致
2. **窗口状态**：运行脚本时请保持游戏窗口处于前台且未被遮挡
3. **权限设置**：确保已授予脚本必要的系统权限
3. **权限设置**：部分模块由于使用了快捷键，请确保快捷键为默认值。例如纳塔铁匠铺以及仅领取锻造前检查，使用地图快捷键"M"；模式一矿物识别部分，使用背包快捷键"B"。因为模式一调用了OCR，数字识别部分可能出现错误

## ❓ 常见问题

Q：脚本运行后无反应？
**A**：请按以下步骤排查：
1. 检查游戏分辨率是否符合要求
2. 确认 BGI 版本是否为 0.48.2 或更高
3. 验证脚本配置是否正确
4. 确保游戏窗口处于前台且未被遮挡
5. 确认游戏快捷键设置为默认值（特别是地图"M"和背包"B"键）

Q：OCR识别矿石数量不准确怎么办？
**A**：这是OCR技术的固有局限性，可尝试：

切换到模式二（手动优先级模式）

---

## 📜 更新日志


### 2.3.1`(2025-08-30)`
- **修复**：
  1. 模式一识别开启通知时，发送通知报错
  2. 模式一背包界面不退出的问题 

### 2.3.0`(2025-08-28)`
- **修复**：枫丹铁匠铺跑过头导致失败的问题
- **优化**：仅领取锻造时，先检测大地图左上角是否有【锻造奖励】图标
- **新增**：
  1. 模式选择（默认模式一）
     - 模式一：自动识别背包中数量最多的矿石锻造，失败自动切换到手动优先级（可能存在数量识别错误）
     - 模式二：手动优先级，依次尝试主选及备选矿石
  2. 支持纳塔铁匠铺

### 2.2.1`(2025-08-03)`
- 加快锻造速度
- 优化通知逻辑，减少通知被吞概率

### 2.1
- 使用新版版本号
- 5.7 提高了锻造上限，锻造次数由 3 改为 4

### 2.00523（2025-05-23）
- 新增仅领取锻造
- 优化点击逻辑
- 修复锻造点击次数超过 3 次的 bug

### 2.0（2025-05-22）
- 新增矿石不足时自动选择备用矿石

### 1.40521（2025-05-21）
- 新增矿石未能识别时自动选择备用矿石

### 1.4（2025-05-20）
- 新增通知功能

### 1.3（2025-05-15）
- 修复选择"萃凝晶"时无法识别的问题
- 仓库内新增标签

### 1.2（2025-05-12）
- 修复选择"萃凝晶"时无法识别的 bug

### 1.1（2025-05-01）
- 优化矿石选取方式，改用识图模式

---

**最后更新**：2025 年 8 月 30 日  
**维护者**：@呱呱z

> 💡 提示：建议定期检查更新以获取最佳体验和最新功能