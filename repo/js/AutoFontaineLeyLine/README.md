# AAA 地脉花注意事项

## 零、前言

- 本代码仅供娱乐学习，下载请24小时内删除，禁止用于商业行为，如有BUG，非常欢迎请到测试群反馈或Q119996800。
- 感谢平面镜和D捣蛋两位大佬的基础线路和逻辑。

## 一、省流注意事项


## 二、配置简介

1. **《好感队伍》和《战斗队伍》填写**：如填写了《好感队伍》（用于打完地脉花领取奖励和结束地脉花领取励练点、每日），则《战斗队伍》必须填写，否则无法运行。
   - 冷知识：浓缩树脂只算一次地脉次数，所以在一条龙时可以不合树脂，打完地脉再领每日。如《好感队伍》和《战斗队伍》都不填，则不会切换队伍打地脉花，建议和配置器的配置设置队伍一致。

2. **如果勾选了打完后，领取每日奖励《好感队伍》必填**：建议无论是否需要，《好感队伍》和《战斗队伍》都填，都填一个队伍也行。

3. **《刷取次数》**：默认为6，每条线路4~6朵花，如果不想刷太多次，可选择单线路模式，只会打一条线路内的花，数量为《刷取次数》，如果选择了《耗尽树脂模式》，线路打完也会继续寻找新的线路，直到耗尽浓缩和使用原粹树脂，不会使用小月亮，请放心。

4. **默认选“1”刷蓝色的经验书地脉之花，选“2”为刷金黄色的摩拉地脉之花**。

5. **可填写需要禁用的UID**：禁止此UID刷地脉花，通过派蒙页面左上角的UID进行文字识别，如有多个账号需禁用，使用“/”符号隔开，如12345678/99999999,经过测试，只要在UID数字后面为比较干净的颜色，没有特效动画的名片，识别了100次全正确，再多测看下。

6. **直跑模式**：当打完一个地脉花后，如下一个地脉花比较近，直接跑过去而不是重新传送。

7. **异步检测战斗**：默认打开，请把配置组中的“更快检测结束战斗”和“旋转寻找敌人”关掉，否则可能会出错。


## 三、更新说明

### v.4.3版 全自动枫丹地脉花 20251023

- 修复寻找地脉花时，部分电脑未知BUG出现获取地图中心异常问题，添加错误后调整缩放进行重试机制。

### v.4.2版 全自动枫丹地脉花 20251021

- 修复地区选择BUG。
- 删除游泳检测判断识别，本体已经支持游泳检测返回战斗节点。

### v.4.1版 全自动枫丹地脉花 20250926

- **优化**：
1. 删除拖动模式寻找地脉花，全部使用冒险之证的方式。
2. USEMASK模式有些设备可能无法识别，优化图像识别相关模式。
3. 优化自动拾取相关触发器的关闭，防止误触地脉花。
4. 删除调用BGI自动吃药功能（目前BUG比较多，暂时不开放）。

### v.4.0版 本全自动枫丹地脉花 0250911

- **优化**：
1. 优化模板匹配浓缩树脂和须臾树脂，改用普通匹配，根据分辨率调整匹配度。

### v.3.9版 本全自动枫丹地脉花 0250910

- **新功能**：
1、添加原石购买体力功能，在设定的树脂使用完的前提下，如设定次数大于0，会继续使用原石购买体力领取奖励。

- **优化**：
1. 适配6.0领取界面。
2. 优化开书找地脉花的时序，添加确认大地图打开后才进行寻找。
3. 优化树脂识别正确性。

### v.3.8版本：20250830

- **新功能**：

- **优化**：
1. 改用模板匹配进行浓缩树脂识别，使用颜色遮罩模板，全脚本要求BGI版本提高到0.47.1。
2. 针对2K和4K分辨率，降低匹配度要求，提高识别精度。
2. 优化提前打开地脉花的情况处理。

### v.3.7版本：20250828

- **新功能**：

- **优化**：
1. 优化内存释放。

### v.3.6版本：20250818

- **新功能**：

- **优化**：
1. 领取地脉过程，优化在死亡或低血量时自动到神像回血时的异常处理。
2. 优化线路2和线路6特殊的战斗地点。
3. 加入游泳检测，检测到游泳状态返回战斗失败后，最多重试2次。
4. 48.0版本后，可选激活BGI本体的自动吃药。
   -在“实时触发->自动吃药”中设置检测间隔，和吃药间隔。（建议默认就可以）
   -目前只支持回血和复活药功能（佩戴营养袋，JS配置中勾选“启用吃药检测”才能启用，默认关闭）。
   -BUff类食物目前不稳定，本JS暂不支持BUff类食物
5. 优化相关LOG和设置中的显示。

### v.3.5版本：20250809

- **新功能**：

- **优化**：
1. 树脂识别错误纠正处理。
2. 异步检测错误打开地脉花优化时序。

### v.3.4版本：20250807

- **新功能**：

- **优化**：
1. 优化打开冒险之证的时序，减少冒险之证打开失败的几率。
2. 切换队伍失败后添加返回函数，防止卡在切换界面。
3. 领奖时切换队伍失败或找不到时，通过地图追踪重新寻找一次。
4. 优化JS设置的默认显示和顺序。
5. 优化第六线路第二朵花战斗地点，避免游泳。

### v.3.3版本：20250716

- **新功能**：

- **优化**：
1. 优化战斗完成后寻找地脉花逻辑，提高开花领奖正确率。
2. 优化结束战斗异常和领奖异常的处理。
3. 修复无法使用须臾树脂的问题。

### v.3.2版本：20250705

- **新功能**：
1. 新增默认使用开冒险之证寻找地脉花，比之前更稳定。
2. 新增识别同一线路上的两种地脉花，绕过执行非目标地脉花。
3. 新增死亡检测，死亡后自动恢复后继续执行。

- **优化**：
4. 优化JS配置显示。
5. 优化线路2第五朵花的特殊处理，解决开花和战斗区域太远的问题。
6. 优化设定默认使用异步战斗。
7. 优化领奖速度。

### v.3.1版本：20250702

- **优化**：
1. 优化树脂识别OCR区域。
2. log显示优化。
3. 修复图像识别构造函数错误。

### v.3.0版本：20250701

1. 优化战斗失败自动重试2次。
2. 优化当有须臾树脂，脆弱树脂不显示的处理。
3. 优化在地脉已经打过时，直接领取奖励。

### v.2.9版本：20250629

1. 添加树脂数量识别，防止树脂耗尽的时候多跑一次。

### v.2.8版本：20250626

1. 减少直跑模式下的途经点数量，防止卡死。

### v.2.7版本：20250621

1. 优化超时时间的设定。

### v.2.6版本：20250620

1. 修复参数错误
2. 前往地脉花和领取奖励坐标优化，减少不必要的位置判断点，加速到达和领取。

### v.2.5版本：20250619

1. 适配5.7版本树脂的选择使用。
   - 说明：设定树脂顺序,1=浓缩树脂/2=原粹树脂/3=脆弱树脂/4=须臾树脂，用`/`隔开，填写对应的树脂数字即可,默认：1/2 ，表示先使用浓缩树脂，再使用原粹树脂，不填的不使用"

### v.2.4版本：20250613

1. 特殊处理第二线路第5朵花，避免传送到螃蟹。
2. 调整领取OCR范围，添加选择优先使用的树脂类型（适配3次地脉双倍）。
3. 调整按次数执行逻辑，解决次数大于单线路打不够次数的问题。

### v.2.3版本：20250528

1. 优化寻找地脉花逻辑。

### v.2.2版本：20250524

1. 参考D捣蛋和秋云佬的代码，加入异步检测战斗结束。

### v.2.1版本：20250512

1. 更改UID识别方法。（适配原神UI改变）

### v.2.0版本：20250503

1. 重写寻找地脉花线路方法,删除模糊寻找模式。
2. 添加直跑模式，当打完一个地脉花后，如下一个地脉花比较近，直接跑过去而不是重新传送。（要求BGI的44.8版本）

### v.1.3版本：202500422

1. 优化最后领奖时检测是否误触地脉之花导致任务失败的问题。
2. 修复模糊模式下找到地脉花但没有的情况下会继续寻找地脉花的问题。
3. 优化模糊查找下的开始线路。
4. 修复由于检测地脉之花页面导致的软件报错。

### v.1.2版本：20250414

1. 优化切换队伍时间，避免可能得切换队伍失败导致退出的情况。
2. 修复线路2在快速寻找模式下识别不准确问题。
3. 优化提前出地脉花的检测时间。
4. 特殊处理：1、枫丹路线2秋分山西侧锚点左下第五朵花特殊处理，避免错误传送到地下螃蟹，直接跑过去。

### v.1.1版本：20250410

1. 修复自动战斗不停向前走的问题。
2. 修复第一次战斗部不切换战斗队伍问题。
3. 修复线路1第三朵花文件命错误。
4. 修复队伍未填写判断为已定义问题，改为在设置过又删除队伍后判断未未定义。
5. 修复树脂耗尽模式下，不打完整体线路问题，改为强制打完整体线路。
6. 新增，如地脉花线路不在初始位置，快速模式是找不到的，在模糊位置可能被找到，即线路在被打过后，尝试通过无视树脂是否用完，遍历此线路查找线路剩余的地脉花，如再次找到地脉花，恢复正常判断树脂是否用完。
7. 优化快速查找模式下的准确性。
8. 优化模糊模式下的搜索范围，和坐标位置。