# 传送并自动秘境 (增强版)

本脚本为 **BetterGI** 自带脚本的增强版本。
允许用户直接在脚本设置中自定义“刷取次数”、“树脂类型”及其他高级参数，支持周期性素材刷取，无需修改 BetterGI 全局设置。

---

## ✨ 主要功能

* **全球时区自动换日**：内置时区计算逻辑，自动适配游戏服务器换日时间。
* **自定义树脂策略**：支持指定各类型树脂的使用次数，或选择自动刷取至树脂耗尽。
* **智能队伍切换**：进本前自动切换至指定队伍。
* **全自动托管**：自动传送、进门、战斗及领奖。
* **自动处理**：支持结束后自动分解圣遗物。

---

## 🚀 使用方法

> ⚠️ **重要**：本脚本的参数需要在**调度器**中配置！

1.  在调度器中添加脚本。
2.  **右键点击**脚本并选择 **“修改JS脚本自定义配置”**。

### 📌 必填项

* **指定要前往的秘境**
    * 请在下拉菜单中选择目标副本。
    * **注意**：【角色天赋】、【武器升级】、【圣遗物】三类选项**互斥** (只能选其中一个)，若同时选择多项，脚本将报错停止。

* **树脂策略配置**
    * **刷取至树脂耗尽 (最高优先级)**
        * 若启用此选项，脚本将**忽略**下方所有具体次数的设定。
        * 消耗逻辑：优先使用**浓缩树脂**，耗尽后使用**原粹树脂**。
    * **指定每种树脂刷取次数**
        * 仅在“刷取至树脂耗尽”**关闭**时生效。
        * 脚本将按照设定的次数进行刷取（若四项均为 0 则不执行战斗）。
        * 支持的树脂类型：
            * **浓缩树脂**
            * **原粹树脂** (注意：单次消耗 20 或 40 取决于秘境内上次的记忆设定)
            * **须臾树脂**
            * **脆弱树脂**

### ⚙️ 可选项

* **【风险】强制运行**
    * **功能**：勾选后将**忽略日期与星期几的检查**，直接进入副本。
    * **适用场景**：仅在确认游戏内有“限时全开”或“精通移涌”活动时使用。
    * **警告**：若当日未开放该素材且无活动，勾选此项将会导致刷错素材。

* **自动切换到指定队伍**
    * 输入预设队伍名称（需与游戏内完全一致，支持正则表达式），留空则不切换。

* **秘境刷取轮数**
    * `0`：刷到体力耗尽或达到指定树脂次数（默认）。
    * `数字`：刷满该场数后强制停止（无论是否还有体力）。

* **战斗完成后等待时间**
    * 设置战斗结算后的缓冲秒数（默认 5 秒），防止因电脑读取卡顿导致过早退出或识别失败。

* **结束后自动分解圣遗物**
    * **功能**：开启后，任务结束前会自动执行圣遗物分解逻辑。
    * **分解星级**：可指定分解 **1~4 星** 的圣遗物（需配合下拉菜单设置）。

* **启用调试模式**
    * 开启后会输出更多详细日志信息，用于脚本出错时排查问题。

---

## ⏰ 时区设置

脚本会自动读取 BetterGI 的全局设置来判定今日素材。
请务必前往 **BetterGI设置 > 其他设置 > 服务器时区设置** 进行正确配置（如亚服设为 UTC+08:00）。

---

## ⚠️ 已知问题

### 1. 原粹树脂消耗量 (20 vs 40)
BetterGI 传送并自动秘境任务不支持JS脚本选择 20 或 40 树脂。
若未手动切换，游戏会**沿用上一次**刷取时的设定。
* **操作建议**：若您打算使用原粹树脂，请在运行脚本前**手动进入一次秘境**，调整好 20 或 40 的选项。

### 2. 为什么不能自动识别 "限时全开" 活动？
受限于 BetterGI 的底层架构设计，**JS 脚本无法获取游戏内的画面资讯**：
* **执行时序矛盾**：JS 脚本必须在任务开始 **前** 决定策略（刷什么副本），而 "限时全开" 的 OCR 识别是在任务开始 **后**（C# 底层进入秘境介面时）才执行 。
* **数据无法回传**：BetterGI 的 API 设计为「射后不理」(Fire-and-Wait)，底层的 OCR 识别结果（如是否有限时字样）并不会回传给 JS 层 。

因此，本脚本仅能依赖 **纯数学计算** 来判断素材开放日。若当前有 "限时全开" 或 "精通移涌" 活动，请务必手动勾选 **「强制运行」** 以绕过日期检查。

---

## 👨‍💻 关于作者

* **原作者**: [huiyadanli](https://github.com/huiyadanli), iris, 霁
* **修改者**: [RJFAC](https://github.com/RJFAC)
* **辅助生成**: AI